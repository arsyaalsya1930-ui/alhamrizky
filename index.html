<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bengkelku</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
        body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      margin: 0; 
      background: #f0f4f8; 
      color: #333;
    }
    h2 { 
      text-align: center; 
      margin-bottom: 20px; 
      color: #2c3e50; 
    }

    /* Navbar atas */
    .navbar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      background: linear-gradient(90deg, #0066cc, #0099ff);
      padding: 12px;
      position: sticky;
      top: 0;
      z-index: 999;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .navbar a {
      color: #fff;
      text-decoration: none;
      font-size: 22px;
      transition: 0.3s;
      padding: 8px;
      border-radius: 8px;
    }
    .navbar a:hover { 
      background: rgba(255,255,255,0.2); 
      transform: scale(1.15); 
    }
    .navbar a.active { 
      background: #fff; 
      color: #0066cc; 
      font-weight: bold;
    }

    /* Konten */
    .content { padding: 20px; }

    /* Box dan form */
    form, .total-box, .filter-box { 
      max-width: 800px; 
      margin: 15px auto; 
      padding: 20px; 
      border: none; 
      background: #fff; 
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    form input, form select, button { 
      margin: 6px 0; 
      padding: 10px; 
      width: 100%; 
      border: 1px solid #ccd; 
      border-radius: 6px;
      font-size: 14px;
      transition: 0.3s;
    }
    form input:focus, form select:focus { 
      outline: none; 
      border-color: #0099ff; 
      box-shadow: 0 0 4px rgba(0,153,255,0.4); 
    }
    button { 
      background: #0099ff; 
      color: #fff; 
      border: none; 
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #007acc; }

    /* Tabel */
    table { 
      width: 100%; 
      max-width: 850px; 
      margin: 20px auto; 
      border-collapse: collapse; 
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    th, td { 
      border: 1px solid #eee; 
      padding: 10px; 
      text-align: center; 
    }
    th { 
      background: #0099ff; 
      color: #fff; 
      font-weight: 600;
    }
    tr:nth-child(even) { background: #f9fcff; }

    /* Dashboard Card */
    .dashboard {
      max-width: 900px; 
      margin: 20px auto;
      display: flex; 
      gap: 20px; 
      flex-wrap: wrap; 
      justify-content: space-around;
    }
    .card {
      flex: 1; 
      min-width: 180px; 
      background: linear-gradient(135deg, #ffffff, #f0f8ff);
      border: none;
      border-radius: 12px; 
      padding: 20px; 
      text-align: center;
      box-shadow: 0 6px 12px rgba(0,0,0,0.08);
      transition: 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 18px rgba(0,0,0,0.15);
    }
    .card h3 { 
      margin: 0; 
      font-size: 16px; 
      color: #444; 
    }
    .card p { 
      margin: 8px 0 0; 
      font-size: 20px; 
      font-weight: bold; 
      color: #0066cc;
    }

    .delete-btn { 
      margin-top: 10px; 
      padding: 10px 14px; 
      background: #e74c3c;
      color: #fff; 
      border: none; 
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    .delete-btn:hover { background: #c0392b; }

  </style>
</head>
<body>
  <!-- ðŸ”¥ Navbar -->
  <div class="navbar">
    <a href="#" onclick="showPage('dashboard')" id="menuDashboard" class="active"><i class="fas fa-home"></i></a>
    <a href="#" onclick="showPage('transaksi')" id="menuTransaksi"><i class="fas fa-cash-register"></i></a>
    <a href="#" onclick="showPage('barang')" id="menuBarang"><i class="fas fa-box"></i></a>
    <a href="#" onclick="showPage('laporan')" id="menuLaporan"><i class="fas fa-file-alt"></i></a>
  </div>

  <div class="content">
    <!-- Dashboard -->
    <div id="pageDashboard">
      <h2>DASHBOARD BENGKEL PROMOTOR</h2>
      <h2>Total Transaksi Hari Ini</h2>
      <div class="dashboard">
        <div class="card"><h3>Total Hari Ini</h3><p id="totalHariIniDashboard">Rp 0</p></div>
        <div class="card"><h3>Alham</h3><p id="totalAlhamDashboard">Rp 0</p></div>
        <div class="card"><h3>Ical</h3><p id="totalIcalDashboard">Rp 0</p></div>
        <div class="card"><h3>Bengkel</h3><p id="totalBengkelDashboard">Rp 0</p></div>
      </div>
    </div>

    <!-- Transaksi -->
    <div id="pageTransaksi" style="display:none;">
      <h2>Transaksi Bengkel</h2>
      <form id="formTransaksi">
        <label>Tanggal:</label>
        <input type="date" id="tanggal">
        <label>Jenis:</label>
        <select id="jenis">
          <option value="Jasa">Jasa</option>
          <option value="Barang">Barang</option>
        </select>
        <label>Nama Jasa/Barang:</label>
        <input type="text" id="nama" required>
        <label>Harga (Rp):</label>
        <input type="number" id="harga" required>
        <div id="mekanikSection">
          <label>Pilih Mekanik:</label>
          <select id="mekanik">
            <option value="Alham">Alham</option>
            <option value="Ical">Ical</option>
            <option value="Zainal">Zainal</option>
          </select>
          <label>Persentase Mekanik (%):</label>
          <input type="number" id="persenMekanik" placeholder="contoh: 30" min="0" max="100">
        </div>
        <button type="submit">Tambah</button>
      </form>

      <!-- Filter -->
      <div class="filter-box">
        <label>Dari Tanggal:</label>
        <input type="date" id="filterDari">
        <label>Sampai Tanggal:</label>
        <input type="date" id="filterSampai">
        <button onclick="filterRangeTanggal()">Terapkan</button>
        <button onclick="resetFilter()">Reset</button>
      </div>

      <!-- Dashboard Ringkas -->
      <div class="dashboard">
        <div class="card"><h3>Total Hari Ini</h3><p id="totalHariIni">Rp 0</p></div>
        <div class="card"><h3>Alham</h3><p id="totalAlhamCard">Rp 0</p></div>
        <div class="card"><h3>Ical</h3><p id="totalIcalCard">Rp 0</p></div>
        <div class="card"><h3>Bengkel</h3><p id="totalBengkelCard">Rp 0</p></div>
      </div>

      <!-- Tabel -->
      <table id="tabelData">
        <thead>
          <tr>
            <th>Pilih</th><th>Tanggal</th><th>Jenis</th><th>Nama</th>
            <th>Harga</th><th>Mekanik</th><th>%</th><th>Bagian Mekanik</th><th>Bagian Bengkel</th><th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="total-box">
        <button class="delete-btn" onclick="hapusTerpilih()">Hapus Terpilih</button>
        <button class="delete-btn" onclick="exportPDF()">Export ke PDF</button>
      </div>
    </div>

    <!-- Barang -->
    <div id="pageBarang" style="display:none;">
      <h2>Daftar Barang</h2>
      <form id="formBarang">
        <label>Nama Barang:</label>
        <input type="text" id="namaBarang" required>
        <label>Harga Jual (Rp):</label>
        <input type="number" id="hargaJual" required>
        <label>Harga Pasang (Rp):</label>
        <input type="number" id="hargaPasang" required>
        <button type="submit">Tambah Barang</button>
      </form>

      <div class="filter-box">
        <label>Cari Barang:</label>
        <input type="text" id="searchBarang" placeholder="ketik nama barang...">
      </div>

      <table id="tabelBarang">
        <thead>
          <tr>
            <th>Nama Barang</th><th>Harga Jual</th><th>Harga Pasang</th><th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Laporan -->
    <div id="pageLaporan" style="display:none;">
      <h2>Laporan</h2>
      <p>Laporan transaksi bisa diexport dari menu transaksi.</p>
    </div>
  </div>

  <!-- JS Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // ðŸ”¥ Navbar Function
    function showPage(page) {
      document.querySelectorAll('.content > div').forEach(div => div.style.display = 'none');
      document.getElementById('page' + page.charAt(0).toUpperCase() + page.slice(1)).style.display = 'block';
      document.querySelectorAll('.navbar a').forEach(a => a.classList.remove('active'));
      document.getElementById('menu' + page.charAt(0).toUpperCase() + page.slice(1)).classList.add('active');
    }

    // ==================== TRANSAKSI ====================
    const form = document.getElementById('formTransaksi');
    const tabelBody = document.querySelector('#tabelData tbody');
    const jenis = document.getElementById('jenis');
    const mekanikSection = document.getElementById('mekanikSection');
    const tanggalInput = document.getElementById('tanggal');
    const today = new Date().toISOString().split('T')[0];
    tanggalInput.value = today;

    let dataTransaksi = JSON.parse(localStorage.getItem("dataBengkel")) || [];
    let filterAktif = today;
    let editIndex = null;
    renderTable();

    jenis.addEventListener('change', () => {
      mekanikSection.style.display = (jenis.value === 'Jasa') ? 'block' : 'none';
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const tanggal = tanggalInput.value;
      const nama = document.getElementById('nama').value;
      const harga = parseFloat(document.getElementById('harga').value);
      const mekanik = document.getElementById('mekanik').value;
      const persenMekanik = parseInt(document.getElementById('persenMekanik').value) || 0;

      let bagianMekanik = 0, bagianBengkel = 0, mekanikFinal = '-', persenFinal = 0;
      if (jenis.value === 'Barang') {
        bagianMekanik = 0; bagianBengkel = harga;
      } else {
        bagianMekanik = (harga * persenMekanik) / 100;
        bagianBengkel = harga - bagianMekanik;
        mekanikFinal = mekanik; persenFinal = persenMekanik;
      }
      const newData = {tanggal, jenis: jenis.value, nama, harga, mekanik: mekanikFinal, persen: persenFinal, bagianMekanik, bagianBengkel};
      if (editIndex !== null) { 
        dataTransaksi[editIndex] = newData; 
        editIndex = null; 
        Swal.fire("Berhasil!", "Transaksi berhasil diupdate!", "success");
      }
      else { 
        dataTransaksi.push(newData); 
        Swal.fire("Berhasil!", "Transaksi berhasil ditambahkan!", "success");
      }
      saveData(); renderTable(); form.reset(); tanggalInput.value = today; jenis.dispatchEvent(new Event('change'));
    });

    function renderTable() {
      tabelBody.innerHTML = "";
      let totalHariIni = 0, totalAlham = 0, totalIcal = 0, totalBengkel = 0;
      dataTransaksi.filter(item => Array.isArray(filterAktif)? item.tanggal >= filterAktif[0] && item.tanggal <= filterAktif[1] : item.tanggal === filterAktif)
        .forEach((item, i) => {
          const row = `<tr>
              <td><input type="checkbox" class="pilihHapus" data-index="${i}"></td>
              <td>${item.tanggal}</td><td>${item.jenis}</td><td>${item.nama}</td>
              <td>${item.harga.toLocaleString()}</td><td>${item.mekanik}</td><td>${item.persen || '-'}</td>
              <td>${item.bagianMekanik.toLocaleString()}</td><td>${item.bagianBengkel.toLocaleString()}</td>
              <td><button onclick="editData(${i})">Edit</button></td></tr>`;
          tabelBody.insertAdjacentHTML('beforeend', row);
          totalHariIni += item.harga;
          if (item.mekanik === 'Alham') totalAlham += item.bagianMekanik;
          if (item.mekanik === 'Ical') totalIcal += item.bagianMekanik;
          totalBengkel += item.bagianBengkel;
        });
      document.getElementById('totalHariIni').innerText = totalHariIni.toLocaleString('id-ID');
      document.getElementById('totalAlhamCard').innerText = totalAlham.toLocaleString('id-ID');
      document.getElementById('totalIcalCard').innerText = totalIcal.toLocaleString('id-ID');
      document.getElementById('totalBengkelCard').innerText = totalBengkel.toLocaleString('id-ID');
      document.getElementById('totalHariIniDashboard').innerText = totalHariIni.toLocaleString('id-ID');
      document.getElementById('totalAlhamDashboard').innerText = totalAlham.toLocaleString('id-ID');
      document.getElementById('totalIcalDashboard').innerText = totalIcal.toLocaleString('id-ID');
      document.getElementById('totalBengkelDashboard').innerText = totalBengkel.toLocaleString('id-ID');
    }

    function editData(index) {
      const item = dataTransaksi[index];
      tanggalInput.value = item.tanggal; document.getElementById('jenis').value = item.jenis;
      document.getElementById('nama').value = item.nama; document.getElementById('harga').value = item.harga;
      document.getElementById('mekanik').value = item.mekanik; document.getElementById('persenMekanik').value = item.persen;
      jenis.dispatchEvent(new Event('change')); editIndex = index;
    }

    function hapusTerpilih() {
      const ceklis = document.querySelectorAll('.pilihHapus:checked');
      if (ceklis.length === 0) return;
      Swal.fire({
        title: "Yakin hapus data terpilih?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Ya, hapus!",
        cancelButtonText: "Batal"
      }).then(res => {
        if(res.isConfirmed){
          const indexHapus = [...ceklis].map(c => parseInt(c.dataset.index)).sort((a,b)=>b-a);
          indexHapus.forEach(i => dataTransaksi.splice(i,1)); 
          saveData(); renderTable();
          Swal.fire("Terhapus!", "Data berhasil dihapus", "success");
        }
      });
    }

    function saveData() { localStorage.setItem("dataBengkel", JSON.stringify(dataTransaksi)); }
    function resetFilter() { filterAktif = today; renderTable(); }
    function filterRangeTanggal() {
      const dari = document.getElementById('filterDari').value, sampai = document.getElementById('filterSampai').value;
      filterAktif = (dari && sampai)? [dari, sampai] : today; renderTable();
    }
    function exportPDF() {
      const element = document.createElement("div");
      element.innerHTML = `<h3>Laporan Bengkel</h3>${document.getElementById("tabelData").outerHTML}`;
      html2pdf().from(element).save(`laporan-bengkel.pdf`);
    }

    // ==================== BARANG ====================
    const formBarang = document.getElementById('formBarang');
    const tabelBarang = document.querySelector('#tabelBarang tbody');
    const searchBarang = document.getElementById('searchBarang');
    let dataBarang = JSON.parse(localStorage.getItem("dataBarang")) || [];
    renderBarang();

    formBarang.addEventListener('submit', function(e){
      e.preventDefault();
      const nama = document.getElementById('namaBarang').value;
      const jual = parseFloat(document.getElementById('hargaJual').value);
      const pasang = parseFloat(document.getElementById('hargaPasang').value);
      dataBarang.push({nama, jual, pasang});
      localStorage.setItem("dataBarang", JSON.stringify(dataBarang));
      renderBarang(); formBarang.reset();
      Swal.fire("Berhasil!", "Barang berhasil ditambahkan!", "success");
    });

    function renderBarang(){
      tabelBarang.innerHTML = "";
      dataBarang.filter(b=> b.nama.toLowerCase().includes(searchBarang.value.toLowerCase()))
        .forEach((b,i)=>{
          const row = `<tr>
            <td>${b.nama}</td><td>${b.jual.toLocaleString()}</td><td>${b.pasang.toLocaleString()}</td>
            <td><button onclick="hapusBarang(${i})">Hapus</button></td>
          </tr>`;
          tabelBarang.insertAdjacentHTML('beforeend', row);
        });
    }
        function exportPDF() {
      const element = document.createElement("div");
      element.innerHTML = `<h3>Laporan Bengkel</h3>${document.getElementById("tabelData").outerHTML}`;
      html2pdf().from(element).save(`laporan-bengkel.pdf`);
    }

        function hapusBarang(index){
  Swal.fire({
    title: "Yakin hapus barang ini?",
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "Ya, hapus!",
    cancelButtonText: "Batal"
  }).then(res => {
    if(res.isConfirmed){
      dataBarang.splice(index, 1);
      localStorage.setItem("dataBarang", JSON.stringify(dataBarang));
      renderBarang();
      Swal.fire("Terhapus!", "Barang berhasil dihapus", "success");
    } else {
      Swal.fire("Dibatalkan", "Barang tidak jadi dihapus", "info");
    }
  });
}


    searchBarang.addEventListener('input', renderBarang);
  </script>

  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./service-worker.js")
      .then(reg => console.log("Service Worker terdaftar:", reg))
      .catch(err => console.log("Service Worker gagal:", err));
  }
  </script>
</body>
</html>

